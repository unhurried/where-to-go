!function(){"use strict";angular.module("whereToGo",["ngAnimate","ngCookies","ngTouch","ngSanitize","ngMessages","ngAria","ngResource","ui.router","ui.bootstrap","toastr","LocalStorageModule","datatables","uiGmapgoogle-maps","datatables"])}(),function(){"use strict";function e(e,t,a,o,l,n){var i=this;i.dtOptions=o.newOptions(),i.DTColumnDefs=[l.newColumnDef(2).withOption("sType","num"),l.newColumnDef(3).withOption("sType","num")],i.geocode=function(e,t){(null==e||""==e)&&t({});var a=new google.maps.Geocoder;a.geocode({address:e},function(e,a){if("OK"==a){var o=e[0].geometry.location.lat(),l=e[0].geometry.location.lng();t({latitude:o,longitude:l})}})},i.home=a.get("home"),i.home=i.home||{},i.homeForm=i.home,e.$watch(function(){return i.home},function(){a.set("home",i.home)},!0),i.showHomeForm=function(){i.homeModalInstance=t.open({templateUrl:"homeForm",scope:e})},i.geocodeHome=function(){i.geocode(i.homeForm.name,function(t){i.homeForm.latitude=t.latitude,i.homeForm.longitude=t.longitude,e.$apply()})},i.registerHome=function(){i.home.name=i.homeForm.name,i.home.latitude=i.homeForm.latitude,i.home.longitude=i.homeForm.longitude,i.homeModalInstance.close()},i.placeMap=a.get("placeMap"),i.placeMap=i.placeMap||{},e.$watch(function(){return i.placeMap},function(){a.set("placeMap",i.placeMap)},!0),i.deletePlace=function(e){delete i.placeMap[e],i.placeModalInstance.close()},i.recalculate=function(){var t=new google.maps.LatLng(i.home.latitude,i.home.longitude),a=[];angular.forEach(i.placeMap,function(e){a.push(new google.maps.LatLng(e.latitude,e.longitude))});var o=new google.maps.DistanceMatrixService;o.getDistanceMatrix({origins:[t],destinations:a,travelMode:google.maps.TravelMode.DRIVING,avoidHighways:!1,avoidTolls:!1},function(t,a){if(a==google.maps.DistanceMatrixStatus.OK){var o=0;angular.forEach(i.placeMap,function(e){var a=t.rows[0].elements[o];e.distance=a.distance.value,e.duration=a.duration.value,o++}),e.$apply()}})},i.exportPlaceList=function(){n["export"](i.placeMap,["id","category","name","memo"])},i.map={center:{latitude:i.home.latitude,longitude:i.home.longitude},zoom:10},i.showPlaceForm=function(a){null==a?i.placeForm=angular.copy(i.home):i.placeForm=angular.copy(i.placeMap[a]),i.placeModalInstance=t.open({templateUrl:"placeForm",scope:e}),i.placeModalInstance.rendered.then(function(){var e=i.placeFormMap.control.getGMap();google.maps.event.trigger(e,"resize"),i.placeFormMap.center={latitude:i.placeForm.latitude,longitude:i.placeForm.longitude},i.placeFormMap.marker=i.placeForm})},i.geocodePlace=function(){i.geocode(i.placeForm.name,function(t){i.placeForm.latitude=t.latitude,i.placeForm.longitude=t.longitude,i.placeFormMap.center={latitude:i.placeForm.latitude,longitude:i.placeForm.longitude},e.$apply()})},i.createOrUpdatePlace=function(){var e=angular.copy(i.placeForm);null==e.id&&(e.id=UUIDjs.create().toString()),i.placeMap[e.id]=e,i.placeForm={},i.placeModalInstance.close()},i.placeFormMap={},i.placeFormMap.center={latitude:0,longitude:0},i.placeFormMap.marker=i.placeForm,i.placeFormMap.style={display:"block"},i.placeFormMap.control={},i.placeFormMap.toggle=function(){"none"==i.placeFormMap.style.display?i.placeFormMap.style={display:"block"}:i.placeFormMap.style={display:"none"}},i.placeFormMap.setMarker=function(t,a,o){i.placeForm.latitude=o[0].latLng.lat(),i.placeForm.longitude=o[0].latLng.lng(),e.$apply()}}e.$inject=["$scope","$modal","localStorageService","DTOptionsBuilder","DTColumnDefBuilder","CsvExporter"],angular.module("whereToGo").controller("MainController",e)}(),function(){"use strict";function e(e){this["export"]=function(t,a){var o=a.join(",")+"\n";angular.forEach(t,function(e){var t="";angular.forEach(a,function(a,o){0!=o&&(t+=","),e[a]&&(t+=e[a])}),o+=t+"\n"});var l=new Blob([o],{type:"text/csv"});if(e.navigator.msSaveBlob)e.navigator.msSaveBlob(l,"export.csv");else{var n=e.document.getElementById("csv_exporter");null==n&&(n=e.document.createElement("a"),n.setAttribute("id","csv_exporter"),n.setAttribute("style","display:none;"),n.setAttribute("download","export.csv")),n.setAttribute("href",e.URL.createObjectURL(l)),n.click()}}}e.$inject=["$window"],angular.module("whereToGo").service("CsvExporter",e)}(),function(){"use strict";function e(e){e.debug("runBlock end")}e.$inject=["$log"],angular.module("whereToGo").run(e)}(),function(){"use strict";function e(e,t){e.state("home",{url:"/",templateUrl:"app/main/main.html",controller:"MainController",controllerAs:"main"}),t.otherwise("/")}e.$inject=["$stateProvider","$urlRouterProvider"],angular.module("whereToGo").config(e)}(),function(){"use strict";angular.module("whereToGo").constant("malarkey",malarkey).constant("moment",moment)}(),function(){"use strict";function e(e,t){e.debugEnabled(!0),t.allowHtml=!0,t.timeOut=3e3,t.positionClass="toast-top-right",t.preventDuplicates=!0,t.progressBar=!0}e.$inject=["$logProvider","toastrConfig"],angular.module("whereToGo").config(e)}(),angular.module("whereToGo").run(["$templateCache",function(e){e.put("app/main/main.html",'<div class="container"><h1>Where To Go</h1><div class="row" style="margin:20px;"><span ng-if="main.home.latitude != null && main.home.longitude != null" class="label label-default" style="margin-right:12px">Home is regsterd</span> <input ng-if="main.home.latitude != null && main.home.longitude != null" type="button" value="Update" class="btn btn-primary" style="margin-right:12px" ng-click="main.showHomeForm()"> <input ng-if="main.home.latitude != null && main.home.longitude != null" type="button" value="Recalculate" class="btn btn-primary" ng-click="main.recalculate()"> <span ng-if="main.home.latitude == null || main.home.longitude == null" class="label label-danger" style="margin-right:12px">Home is not regsterd</span> <input ng-if="main.home.latitude == null || main.home.longitude == null" type="button" value="Register" class="btn btn-primary" ng-click="main.showHomeForm()"> <input type="button" value="Export" class="btn btn-primary pull-right" ng-click="main.exportPlaceList()"> <input type="button" value="New Place" class="btn btn-primary pull-right" style="margin-right:12px" ng-click="main.showPlaceForm()"></div><table datatable="ng" dt-options="main.dtOptions" dt-column-defs="main.DTColumnDefs" class="table table-striped"><thead><tr><th>Category</th><th>Name</th><th>Distance (km)</th><th>Duration (min)</th><th>Memo</th></tr></thead><tr ng-repeat="(id, place) in main.placeMap" ng-click="main.showPlaceForm(place.id)"><td>{{ place.category }}</td><td><a target="_blank" href="{{ place.url }}">{{ place.name }}</a></td><td>{{ (place.distance / 1000).toFixed(0) }}</td><td>{{ (place.duration / 60 ).toFixed(0) }}</td><td>{{ place.memo }}</td></tr></table><div style="margin-top:10px;"><ui-gmap-google-map center="main.map.center" zoom="main.map.zoom" idkey="0"><ui-gmap-marker ng-repeat="(id, place) in main.placeMap" coords="{latitude:place.latitude, longitude:place.longitude}" options="{text:place.name}" events="marker.events" idkey="place.id"><ui-gmap-window show="true">{{ place.name }}</ui-gmap-window></ui-gmap-marker></ui-gmap-google-map></div><script type="text/ng-template" id="homeForm"><div class="modal-body"> <div style="margin: 20px;"> <form class="form-horizontal" ng-submit="main.registerHome()"> <div class="form-group form-inline"> <input type="text" placeholder="name" class="form-control" style="width:250px;margin-right:12px;" ng-model="main.homeForm.name"> <input type="button" value="Geocode" class="btn" ng-click="main.geocodeHome()"> </div> <div class="form-group form-inline"> <input type="text" placeholder="latitude" class="form-control" style="width:120px;margin-right:12px;" ng-model="main.homeForm.latitude"> <input type="text" placeholder="longitude" class="form-control" style="width:120px;margin-right:12px;" ng-model="main.homeForm.longitude"> </div> <div class="form-group"> <input type="submit" value="Register" class="btn btn-primary"> </div> </form> </div> </div></script><script type="text/ng-template" id="placeForm"><div class="modal-body"> <div style="margin: 20px;"> <form class="form-horizontal" ng-submit="main.createOrUpdatePlace()"> <div class="form-group form-inline"> <input type="text" placeholder="category" class="form-control" style="width:120px;margin-right:12px;" ng-model="main.placeForm.category"> <input type="text" placeholder="name" class="form-control" style="width:200px;margin-right:12px;" ng-model="main.placeForm.name"> <input type="button" value="Geocode" class="btn" ng-click="main.geocodePlace()"> </div> <div class="form-group form-inline"> <input type="text" placeholder="latitude" class="form-control" style="width:120px;margin-right:12px;" ng-model="main.placeForm.latitude"> <input type="text" placeholder="longitude" class="form-control" style="width:120px;margin-right:12px;" ng-model="main.placeForm.longitude"> <input type="button" value="Toggle Map" class="btn" ng-click="main.placeFormMap.toggle()"> </div> <div id="mapChooser" class="form-group" ng-style="main.placeFormMap.style" > <ui-gmap-google-map pan="true" center="main.placeFormMap.center" zoom="12" idKey="100" events="{dblclick:main.placeFormMap.setMarker}" control="main.placeFormMap.control" options="{disableDoubleClickZoom:true}"> <ui-gmap-marker coords="main.placeFormMap.marker" idkey="2"></ui-gmap-marker> </ui-gmap-google-map> </div> <div class="form-group"> <input type="text" placeholder="URL" class="form-control" style="width:450px;" ng-model="main.placeForm.url"> </div> <div class="form-group"> <textarea placeholder="memo" class="form-control" style="width:450px" ng-model="main.placeForm.memo"></textarea> </div> <div class="form-group"> <input type="hidden" value="{{ main.placeForm.id }}"> <input ng-if="main.placeForm.id == null" type="submit" value="Add" class="btn btn-primary"> <input ng-if="main.placeForm.id != null" type="submit" value="Update" class="btn btn-primary" style="margin-right:12px;"> <input ng-if="main.placeForm.id != null" ng-click="main.deletePlace(main.placeForm.id)" type="button" value="Delete" class="btn btn-danger"> </div> </form> </div> </div></script></div>')}]);
//# sourceMappingURL=../maps/scripts/app-081767ac52.js.map
